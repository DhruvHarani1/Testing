<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A Special Surprise</title>

    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React Libraries -->
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>

    <!-- Babel to translate JSX in the browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Custom Styles and Fonts -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Playfair+Display:wght@400;700&family=Kalam&display=swap');
        :root { --ivory: #fdfdfb; --charcoal: #333333; --stone-200: #e7e5e4; --stone-500: #78716c; --stone-600: #57534e; --stone-700: #44403c; --stone-800: #292524; --gradient-start: #fdfdfb; --gradient-end: #fff0f5; }
        body { font-family: 'Inter', sans-serif; color: var(--charcoal); scroll-behavior: smooth; background-color: var(--ivory); }
        .font-body { font-family: 'Inter', sans-serif; }
        .font-serif-display { font-family: 'Playfair Display', serif; }
        .font-handwriting { font-family: 'Kalam', cursive; }
        .animated-gradient { background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end)); background-size: 200% 200%; animation: gradient-animation 15s ease infinite; }
        @keyframes gradient-animation { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        .graphic-container:hover svg { transform: scale(1.1) rotate(-5deg) !important; }
        .compass-svg:hover g { transform: translate(50,50) rotate(360deg); transition: transform 1s ease-out; }
        .animate-draw { stroke-dasharray: 1000; stroke-dashoffset: 1000; animation: draw-animation 5s ease-out forwards; }
        @keyframes draw-animation { to { stroke-dashoffset: 0; } }
        @keyframes float { 0% { transform: translate(-50%, -50%) translateY(0px); } 50% { transform: translate(-50%, -50%) translateY(-15px); } 100% { transform: translate(-50%, -50%) translateY(0px); } }
        .animate-float { animation: float 6s ease-in-out infinite; }
    </style>
</head>
<body>
<div id="root"></div>

<script type="text/babel">
    const { useState, useEffect, useRef } = React;

    // --- Default Data for Form Placeholders ---
    // This object now holds generic placeholder data for all sections.
    const initialConfig = {
        crushName: "",
        yourName: "",
        mainPhotoUrl: "https://placehold.co/1200x800/e0e0e0/333333?text=Main+Photo",
        mainPhotoCaption: "A caption for your favorite photo together.",
        galleryPhotos: [
            { src: "https://placehold.co/600x800/e0e0e0/333333?text=Gallery+1", caption: "A special memory." },
            { src: "https://placehold.co/600x800/e0e0e0/333333?text=Gallery+2", caption: "Another great moment." },
            { src: "https://placehold.co/600x800/e0e0e0/333333?text=Gallery+3", caption: "A day to remember." },
        ],
        handwrittenMessage: "A special message just for them...",
        quiz: {
            question: "What's your favorite memory we've shared?",
            options: [
                { answer: "Option 1", message: "Great choice! I loved that too." },
                { answer: "Option 2", message: "Yes! That was such a fun day." },
                { answer: "Option 3", message: "I was hoping you'd pick that one." }
            ],
        },
        reasons: [
            { title: "Their Best Quality", description: "Describe something you truly admire about them." },
            { title: "A Cute Habit", description: "What's a little thing they do that makes you smile?" },
            { title: "How They Inspire You", description: "How do they make you want to be a better person?" },
        ],
        spotifyPlaylistUri: "https://open.spotify.com/playlist/37i9dQZF1DXcBWIGoYBM5M",
        mapLocations: [
            { x: 30, y: 30, name: "First Date Spot", memory: "Where it all began." },
            { x: 70, y: 50, name: "Favorite Cafe", memory: "All those coffee dates." },
            { x: 50, y: 75, name: "A Special Place", memory: "A memory only we share." },
        ],
        futurePlans: ["Go on a spontaneous road trip.", "Try a cooking class together.", "Watch the sunrise from a beautiful spot."],
        wordCloud: "Kind, Funny, Smart, Beautiful, Inspiring, Genuine",
        reminderReel: [
            { header: "Sunsets", caption: "Every time I see a beautiful sunset, it reminds me of the warmth you bring." },
            { header: "Music", caption: "Whenever I hear a truly romantic song, I think of you." },
            { header: "Laughter", caption: "Your laugh is my favorite sound in the world." },
        ],
        timeCapsule: {
            unlockDate: new Date(new Date().setFullYear(new Date().getFullYear() + 1)).toISOString().split('T')[0], // Defaults to one year from now
            message: "A year from now, I hope we're..."
        },
        outroSecret: "P.S. You mean the world to me.",
    };

    // --- Main App Component ---
    function App() {
        const [config, setConfig] = useState(null);

        const handleCreateSurprise = (formData) => {
            setConfig(formData);
            window.scrollTo(0, 0);
        };

        if (!config) {
            return <ConfigForm onSubmit={handleCreateSurprise} initialData={initialConfig} />;
        }

        return (
            <main className="text-charcoal font-body animated-gradient">
                <IntroSection crushName={config.crushName} />
                <HandwrittenMessage message={config.handwrittenMessage} />
                <GallerySection photos={config.galleryPhotos} />
                <PlaylistSection playlistUri={config.spotifyPlaylistUri} />
                <MapSection locations={config.mapLocations} />
                <Reveal>
                    <div className="py-16 md:py-24 px-4 relative">
                        <img src={config.mainPhotoUrl} alt="A special memory" className="w-full max-w-4xl mx-auto h-auto rounded-lg shadow-2xl object-cover" onError={(e) => { e.target.onerror = null; e.target.src='https://placehold.co/1200x800/e0e0e0/333333?text=Image+Error'; }}/>
                        <div className="absolute bottom-20 md:bottom-28 left-1/2 -translate-x-1/2 w-full px-8">
                            <Reveal>
                                <p className="text-white text-xl md:text-2xl font-serif-display text-center bg-black/30 p-4 rounded-lg backdrop-blur-sm">{config.mainPhotoCaption}</p>
                            </Reveal>
                        </div>
                    </div>
                </Reveal>
                <WordCloudSection words={config.wordCloud.split(',').map(w => w.trim())} />
                <QuizSection quiz={config.quiz} />
                <ReminderReel items={config.reminderReel} />
                <SectionWithGraphic graphic={<Chocolate />} graphicSide="right">
                    <div className="w-full">
                        <h2 className="text-center text-3xl font-serif-display text-stone-700 mb-12">A few reasons you're amazing...</h2>
                        <div className="space-y-8 max-w-md mx-auto">
                            {config.reasons.map((reason, index) => (
                                <div key={index} className="text-left p-6 border border-stone-200 rounded-lg bg-ivory/50 backdrop-blur-sm shadow-sm">
                                    <h3 className="text-xl font-bold text-stone-800 mb-2">{reason.title}</h3>
                                    <p className="text-stone-600">{reason.description}</p>
                                </div>
                            ))}
                        </div>
                    </div>
                </SectionWithGraphic>
                <FutureSection plans={config.futurePlans} />
                <DreamGetawaySection />
                <TimeCapsuleSection capsule={config.timeCapsule} />
                <OutroSection yourName={config.yourName} secret={config.outroSecret} />
            </main>
        );
    }

    // --- Configuration Form Component ---
    function ConfigForm({ onSubmit, initialData }) {
        const [formData, setFormData] = useState(initialData);

        const handleArrayOfObjectsChange = (e, index, section, field) => {
            const { value, type, files } = e.target;
            const newSectionData = [...formData[section]];

            if (type === 'file') {
                if (files && files[0]) {
                    newSectionData[index][field] = URL.createObjectURL(files[0]);
                }
            } else {
                newSectionData[index][field] = value;
            }
            setFormData({ ...formData, [section]: newSectionData });
        };

        const handleTextChange = (e) => {
            const { name, value, type, files } = e.target;
            if (type === 'file') {
                if (files && files[0]) {
                    setFormData({ ...formData, [name]: URL.createObjectURL(files[0]) });
                }
            } else {
                setFormData({ ...formData, [name]: value });
            }
        };

        const handleQuizChange = (e, index, field) => {
            const { value } = e.target;
            const newOptions = [...formData.quiz.options];
            newOptions[index][field] = value;
            setFormData({ ...formData, quiz: { ...formData.quiz, options: newOptions } });
        };

        const handleFuturePlansChange = (e, index) => {
            const newPlans = [...formData.futurePlans];
            newPlans[index] = e.target.value;
            setFormData({ ...formData, futurePlans: newPlans });
        };

        const handleTimeCapsuleChange = (e) => {
            const { name, value } = e.target;
            setFormData({ ...formData, timeCapsule: { ...formData.timeCapsule, [name]: value } });
        };

        const handleSubmit = (e) => {
            e.preventDefault();
            onSubmit(formData);
        };

        return (
            <div className="max-w-4xl mx-auto p-8 bg-white shadow-lg rounded-lg my-12 font-body">
                <h1 className="text-4xl font-serif-display text-stone-700 text-center mb-4">Create Your Surprise</h1>
                <p className="text-stone-500 text-center mb-12">Fill out the details below to create a personalized webpage for your special someone.</p>

                <form onSubmit={handleSubmit} className="space-y-12">
                    {/* Section: Basic Info */}
                    <div className="p-6 border rounded-lg">
                        <h2 className="text-2xl font-serif-display text-stone-600 border-b pb-2 mb-6">Basic Info</h2>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label className="block text-sm font-bold text-stone-600 mb-2">Their Name</label>
                                <input type="text" name="crushName" value={formData.crushName} onChange={handleTextChange} className="w-full p-2 border rounded-md" placeholder="Enter their name" required />
                            </div>
                            <div>
                                <label className="block text-sm font-bold text-stone-600 mb-2">Your Name</label>
                                <input type="text" name="yourName" value={formData.yourName} onChange={handleTextChange} className="w-full p-2 border rounded-md" placeholder="Enter your name" required />
                            </div>
                        </div>
                    </div>

                    {/* Section: Photos */}
                    <div className="p-6 border rounded-lg">
                        <h2 className="text-2xl font-serif-display text-stone-600 border-b pb-2 mb-6">Photos (Required)</h2>
                        <div className="space-y-6">
                            <div>
                                <label className="block text-sm font-bold text-stone-600 mb-2">Main Photo</label>
                                <div className="flex items-center gap-4">
                                    <input type="file" name="mainPhotoUrl" onChange={handleTextChange} accept="image/*" className="w-full text-sm text-stone-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-rose-50 file:text-rose-700 hover:file:bg-rose-100" required/>
                                    <img src={formData.mainPhotoUrl} className="w-16 h-16 object-cover rounded-md bg-stone-100" alt="Preview"/>
                                </div>
                                <label className="block text-sm font-bold text-stone-600 mb-2 mt-4">Main Photo Caption</label>
                                <input type="text" name="mainPhotoCaption" value={formData.mainPhotoCaption} onChange={handleTextChange} className="w-full p-2 border rounded-md" />
                            </div>
                            <h3 className="font-bold text-stone-600 pt-4">"Shared Moments" Gallery (3 Photos)</h3>
                            {formData.galleryPhotos.map((photo, index) => (
                                <div key={index} className="space-y-4 p-4 border-t">
                                    <div className="flex items-center gap-4">
                                        <input type="file" onChange={(e) => handleArrayOfObjectsChange(e, index, 'galleryPhotos', 'src')} accept="image/*" className="w-full text-sm text-stone-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-rose-50 file:text-rose-700 hover:file:bg-rose-100" required/>
                                        <img src={photo.src} className="w-16 h-16 object-cover rounded-md bg-stone-100" alt={`Gallery Preview ${index + 1}`}/>
                                    </div>
                                    <input type="text" placeholder="Caption" value={photo.caption} onChange={(e) => handleArrayOfObjectsChange(e, index, 'galleryPhotos', 'caption')} className="w-full p-2 border rounded-md" />
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* Section: Messages & Text */}
                    <div className="p-6 border rounded-lg">
                        <h2 className="text-2xl font-serif-display text-stone-600 border-b pb-2 mb-6">Messages & Text</h2>
                        <div>
                            <label className="block text-sm font-bold text-stone-600 mb-2">Handwritten-Style Message</label>
                            <input type="text" name="handwrittenMessage" value={formData.handwrittenMessage} onChange={handleTextChange} className="w-full p-2 border rounded-md" />
                        </div>
                        <div className="mt-6">
                            <label className="block text-sm font-bold text-stone-600 mb-2">"Words That Describe You" (comma-separated)</label>
                            <input type="text" name="wordCloud" value={formData.wordCloud} onChange={handleTextChange} className="w-full p-2 border rounded-md" />
                        </div>
                    </div>

                    {/* Section: "This Reminded Me of You" Reel */}
                    <div className="p-6 border rounded-lg">
                        <h2 className="text-2xl font-serif-display text-stone-600 border-b pb-2 mb-6">"This Reminded Me of You"</h2>
                        {formData.reminderReel.map((item, index) => (
                            <div key={index} className="grid grid-cols-1 md:grid-cols-2 gap-4 p-4 border-t">
                                <input type="text" placeholder="Header (e.g., Sunsets)" value={item.header} onChange={(e) => handleArrayOfObjectsChange(e, index, 'reminderReel', 'header')} className="w-full p-2 border rounded-md" required />
                                <input type="text" placeholder="Description" value={item.caption} onChange={(e) => handleArrayOfObjectsChange(e, index, 'reminderReel', 'caption')} className="w-full p-2 border rounded-md" required />
                            </div>
                        ))}
                    </div>

                    {/* Section: Map Locations */}
                    <div className="p-6 border rounded-lg">
                        <h2 className="text-2xl font-serif-display text-stone-600 border-b pb-2 mb-6">Our Map</h2>
                        <p className="text-sm text-stone-500 mb-4">Add three special places. The map layout is fixed, but your memories make it unique.</p>
                        {formData.mapLocations.map((loc, index) => (
                            <div key={index} className="grid grid-cols-1 md:grid-cols-2 gap-4 p-4 border-t">
                                <input type="text" placeholder={`Location ${index + 1} Name`} value={loc.name} onChange={(e) => handleArrayOfObjectsChange(e, index, 'mapLocations', 'name')} className="w-full p-2 border rounded-md" />
                                <input type="text" placeholder={`Memory for Location ${index + 1}`} value={loc.memory} onChange={(e) => handleArrayOfObjectsChange(e, index, 'mapLocations', 'memory')} className="w-full p-2 border rounded-md" />
                            </div>
                        ))}
                    </div>

                    {/* Section: Future Plans */}
                    <div className="p-6 border rounded-lg">
                        <h2 className="text-2xl font-serif-display text-stone-600 border-b pb-2 mb-6">Looking Ahead</h2>
                        <div className="space-y-4">
                            {formData.futurePlans.map((plan, index) => (
                                <div key={index}>
                                    <label className="block text-sm font-bold text-stone-600 mb-2">Future Plan #{index + 1}</label>
                                    <input type="text" value={plan} onChange={(e) => handleFuturePlansChange(e, index)} className="w-full p-2 border rounded-md" />
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* Section: Interactive Quiz */}
                    <div className="p-6 border rounded-lg">
                        <h2 className="text-2xl font-serif-display text-stone-600 border-b pb-2 mb-6">Interactive Quiz</h2>
                        <label className="block text-sm font-bold text-stone-600 mb-2">Quiz Question</label>
                        <input type="text" value={formData.quiz.question} onChange={(e) => setFormData({...formData, quiz: {...formData.quiz, question: e.target.value}})} className="w-full p-2 border rounded-md mb-4"/>
                        {formData.quiz.options.map((opt, index) => (
                            <div key={index} className="grid grid-cols-1 md:grid-cols-2 gap-4 p-4 border-t">
                                <input type="text" placeholder={`Option ${index + 1} Answer`} value={opt.answer} onChange={(e) => handleQuizChange(e, index, 'answer')} className="w-full p-2 border rounded-md" />
                                <input type="text" placeholder={`Response message for Option ${index + 1}`} value={opt.message} onChange={(e) => handleQuizChange(e, index, 'message')} className="w-full p-2 border rounded-md" />
                            </div>
                        ))}
                    </div>

                    {/* Section: Reasons You're Amazing */}
                    <div className="p-6 border rounded-lg">
                        <h2 className="text-2xl font-serif-display text-stone-600 border-b pb-2 mb-6">Reasons They're Amazing</h2>
                        {formData.reasons.map((reason, index) => (
                            <div key={index} className="grid grid-cols-1 md:grid-cols-2 gap-4 p-4 border-t">
                                <input type="text" placeholder="Reason Title (e.g., 'Your Laugh')" value={reason.title} onChange={(e) => handleArrayOfObjectsChange(e, index, 'reasons', 'title')} className="w-full p-2 border rounded-md" />
                                <input type="text" placeholder="Description" value={reason.description} onChange={(e) => handleArrayOfObjectsChange(e, index, 'reasons', 'description')} className="w-full p-2 border rounded-md" />
                            </div>
                        ))}
                    </div>

                    {/* Section: Final Touches */}
                    <div className="p-6 border rounded-lg">
                        <h2 className="text-2xl font-serif-display text-stone-600 border-b pb-2 mb-6">Final Touches</h2>
                        <div className="space-y-6">
                            <div>
                                <label className="block text-sm font-bold text-stone-600 mb-2">Digital Time Capsule</label>
                                <input type="date" name="unlockDate" value={formData.timeCapsule.unlockDate} onChange={handleTimeCapsuleChange} className="w-full p-2 border rounded-md" />
                                <textarea name="message" value={formData.timeCapsule.message} onChange={handleTimeCapsuleChange} className="w-full p-2 border rounded-md mt-2" rows="3" placeholder="Message to be revealed in the future..."></textarea>
                            </div>
                            <div>
                                <label className="block text-sm font-bold text-stone-600 mb-2">Spotify Playlist URL or URI</label>
                                <input type="text" name="spotifyPlaylistUri" value={formData.spotifyPlaylistUri} onChange={handleTextChange} className="w-full p-2 border rounded-md" />
                            </div>
                            <div>
                                <label className="block text-sm font-bold text-stone-600 mb-2">Secret Message for the final star</label>
                                <input type="text" name="outroSecret" value={formData.outroSecret} onChange={handleTextChange} className="w-full p-2 border rounded-md" />
                            </div>
                        </div>
                    </div>

                    <div className="text-center mt-12">
                        <button type="submit" className="px-12 py-4 bg-rose-500 text-white font-bold text-lg rounded-lg shadow-lg hover:bg-rose-600 transition-all transform hover:scale-105">
                            ✨ Create The Surprise! ✨
                        </button>
                    </div>
                </form>
            </div>
        );
    }

    // --- REUSABLE & CORE COMPONENTS ---

    const Reveal = ({ children, threshold = 0.2, className = "" }) => {
        const ref = useRef(null);
        const [isVisible, setIsVisible] = useState(false);

        useEffect(() => {
            const observer = new IntersectionObserver(
                ([entry]) => {
                    if (entry.isIntersecting) {
                        setIsVisible(true);
                        observer.unobserve(entry.target);
                    }
                },
                { root: null, rootMargin: '0px', threshold: threshold }
            );
            if (ref.current) observer.observe(ref.current);
            return () => { if (ref.current) observer.disconnect(); };
        }, [ref, threshold]);

        return (
            <div ref={ref} className={`transition-all duration-1000 ease-out ${isVisible ? 'opacity-100 translate-y-0' : 'opacity-0 translate-y-10'} ${className}`}>
                {children}
            </div>
        );
    };

    const SectionWithGraphic = ({ children, graphic, graphicSide = 'left' }) => {
        const [offsetY, setOffsetY] = useState(0);
        const sectionRef = useRef(null);

        useEffect(() => {
            const handleScroll = () => {
                if (sectionRef.current) {
                    const sectionTop = sectionRef.current.offsetTop;
                    const scrollY = window.scrollY;
                    const relativeScroll = scrollY - sectionTop;
                    if (scrollY > sectionTop - window.innerHeight && scrollY < sectionTop + sectionRef.current.offsetHeight) {
                        setOffsetY(relativeScroll * 0.1);
                    }
                }
            };
            window.addEventListener('scroll', handleScroll);
            return () => window.removeEventListener('scroll', handleScroll);
        }, []);

        return (
            <div ref={sectionRef} className="py-24 md:py-32 px-4">
                <Reveal>
                    <div className="relative w-full max-w-2xl mx-auto text-center">
                        {children}
                        <div
                            className={`graphic-container absolute -z-10 w-32 h-32 md:w-48 md:h-48 top-1/2 ${graphicSide === 'left' ? 'left-0 -translate-x-1/2 md:-translate-x-3/4' : 'right-0 translate-x-1/2 md:translate-x-3/4'}`}
                            style={{ transform: `translateY(calc(-50% + ${offsetY}px))` }}
                        >
                            {graphic}
                        </div>
                    </div>
                </Reveal>
            </div>
        );
    };

    // --- PAGE SECTIONS ---

    const IntroSection = ({ crushName }) => (
        <div className="h-screen flex flex-col items-center justify-center text-center p-4">
            <Reveal>
                <h1 className="text-4xl md:text-5xl font-serif-display text-stone-700">For {crushName}</h1>
                <p className="text-stone-500 mt-4 text-lg">A few thoughts, put into words.</p>
            </Reveal>
            <div className="absolute bottom-8 text-stone-400 animate-bounce"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 5v14" /><path d="m19 12-7 7-7-7" /></svg></div>
        </div>
    );

    const HandwrittenMessage = ({ message }) => {
        const ref = useRef(null);
        const [isVisible, setIsVisible] = useState(false);
        useEffect(() => {
            const observer = new IntersectionObserver(([entry]) => { if (entry.isIntersecting) setIsVisible(true); }, { threshold: 0.5 });
            if (ref.current) observer.observe(ref.current);
            return () => observer.disconnect();
        }, []);

        return (
            <div ref={ref} className="py-24 md:py-32 px-4 text-center">
                <svg viewBox="0 0 800 100" className="w-full max-w-3xl mx-auto">
                    <path id="handwriting-path" d="M 50 50 H 750" fill="transparent" />
                    <text className="text-3xl font-handwriting text-stone-600">
                        <textPath href="#handwriting-path" className={isVisible ? 'animate-draw' : ''}>
                            {message}
                        </textPath>
                    </text>
                </svg>
            </div>
        );
    };

    const GallerySection = ({ photos }) => (
        <div className="py-16 md:py-24">
            <Reveal>
                <h2 className="text-center text-3xl font-serif-display text-stone-700 mb-12">Shared Moments</h2>
                <div className="flex overflow-x-auto space-x-8 pb-8 pl-8 snap-x snap-mandatory">
                    {photos.map((photo, index) => (
                        <div key={index} className="snap-center flex-shrink-0 w-3/4 md:w-1/3 transition-opacity duration-1000">
                            <div className="w-full">
                                <img src={photo.src} alt={photo.caption} className="w-full h-96 object-cover rounded-lg shadow-xl" onError={(e) => { e.target.onerror = null; e.target.src='https://placehold.co/600x800/e0e0e0/333333?text=Image+Error'; }} />
                                <p className="text-center mt-4 text-stone-600">{photo.caption}</p>
                            </div>
                        </div>
                    ))}
                    <div className="flex-shrink-0 w-8"></div>
                </div>
            </Reveal>
        </div>
    );

    const PlaylistSection = ({ playlistUri }) => {
        const getPlaylistId = (uriOrUrl) => {
            try {
                if (uriOrUrl.includes('open.spotify.com')) {
                    const path = new URL(uriOrUrl).pathname;
                    return path.split('/').pop();
                }
                if (uriOrUrl.startsWith('spotify:playlist:')) {
                    return uriOrUrl.split(':').pop();
                }
            } catch (e) { console.error("Could not parse Spotify URI/URL", e); }
            const parts = uriOrUrl.split('/');
            const lastPart = parts.pop() || '';
            return lastPart.split('?')[0];
        };

        const playlistId = getPlaylistId(playlistUri);
        const embedUrl = `https://open.spotify.com/embed/playlist/${playlistId}?utm_source=generator&theme=0`;

        return (
            <SectionWithGraphic graphic={<Headphones />} graphicSide="right">
                <h2 className="text-center text-3xl font-serif-display text-stone-700 mb-8">A Playlist for Us</h2>
                <div className="max-w-md mx-auto">
                    <iframe
                        title="Spotify Playlist"
                        style={{ borderRadius: '12px' }}
                        src={embedUrl}
                        width="100%"
                        height="352"
                        frameBorder="0"
                        allowFullScreen=""
                        allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"
                        loading="lazy"
                    ></iframe>
                </div>
            </SectionWithGraphic>
        );
    };

    const MapSection = ({ locations }) => {
        const [activeLocation, setActiveLocation] = useState(null);
        return (
            <div className="py-24 md:py-32 px-4">
                <Reveal>
                    <h2 className="text-center text-3xl font-serif-display text-stone-700 mb-4">Our Map</h2>
                    <p className="text-center text-stone-500 mb-8">A map of places and memories.</p>
                </Reveal>
                <Reveal className="relative w-full max-w-2xl h-96 mx-auto bg-stone-100/50 rounded-lg border border-stone-200 p-4">
                    <svg width="100%" height="100%" viewBox="0 0 100 100" preserveAspectRatio="none">
                        <path d="M30 30 L 70 50" stroke="#d1d5db" strokeWidth="0.5" fill="none" strokeDasharray="2"/>
                        <path d="M70 50 L 50 75" stroke="#d1d5db" strokeWidth="0.5" fill="none" strokeDasharray="2"/>
                    </svg>
                    {locations.map(loc => (
                        <div key={loc.name} className="absolute group" style={{ left: `${loc.x}%`, top: `${loc.y}%` }}
                             onMouseEnter={() => setActiveLocation(loc)} onMouseLeave={() => setActiveLocation(null)}>
                            <div className="w-4 h-4 bg-rose-400 rounded-full cursor-pointer animate-pulse group-hover:scale-150 transition-transform"></div>
                            <span className="absolute -bottom-6 left-1/2 -translate-x-1/2 text-xs text-stone-600 font-semibold whitespace-nowrap">{loc.name}</span>
                        </div>
                    ))}
                    {activeLocation && (
                        <div className="absolute p-3 bg-white rounded-lg shadow-lg text-left pointer-events-none" style={{ left: `${activeLocation.x}%`, top: `${activeLocation.y}%`, transform: 'translate(20px, -120%)' }}>
                            <p className="text-sm text-stone-600">{activeLocation.memory}</p>
                        </div>
                    )}
                </Reveal>
            </div>
        );
    };

    const WordCloudSection = ({ words }) => (
        <div className="py-24 md:py-32 px-4">
            <Reveal><h2 className="text-center text-3xl font-serif-display text-stone-700 mb-16">Words That Come to Mind</h2></Reveal>
            <Reveal className="relative w-full max-w-2xl h-64 mx-auto">
                {words.map((word, i) => {
                    const angle = (i / words.length) * 2 * Math.PI;
                    const x = 50 + 40 * Math.cos(angle);
                    const y = 50 + 25 * Math.sin(angle);
                    return (
                        <span key={word} className="absolute text-stone-600 text-lg md:text-xl p-2 animate-float"
                              style={{ left: `${x}%`, top: `${y}%`, transform: 'translate(-50%, -50%)', animationDelay: `${i * 0.2}s` }}>
                                {word}
                            </span>
                    );
                })}
            </Reveal>
        </div>
    );

    const QuizSection = ({ quiz }) => {
        const [selectedAnswer, setSelectedAnswer] = useState(null);
        const handleAnswer = (option) => { setSelectedAnswer(option); };

        return (
            <SectionWithGraphic graphic={<CoffeeCup />} graphicSide="left">
                <h2 className="text-2xl md:text-3xl leading-relaxed text-stone-600 font-serif-display mb-8">{quiz.question}</h2>
                <div className="flex flex-col items-center space-y-4">
                    {quiz.options.map(option => (
                        <button key={option.answer} onClick={() => handleAnswer(option)}
                                className={`w-full max-w-sm p-4 border rounded-lg transition-all duration-300 ${selectedAnswer ? 'border-stone-300 opacity-50' : 'border-stone-300 hover:bg-stone-100'}`}>
                            {option.answer}
                        </button>
                    ))}
                </div>
                {selectedAnswer && <Reveal><p className="mt-6 text-emerald-700 font-semibold">{selectedAnswer.message}</p></Reveal>}
            </SectionWithGraphic>
        );
    };

    const ReminderReel = ({ items }) => {
        const joyfulColors = ['bg-rose-200', 'bg-sky-200', 'bg-amber-200'];

        return (
            <div className="py-16 md:py-24 bg-stone-100/50">
                <Reveal><h2 className="text-center text-3xl font-serif-display text-stone-700 mb-16">This Reminded Me of You...</h2></Reveal>
                <div className="max-w-4xl mx-auto px-4 space-y-20">
                    {items.map((item, index) => (
                        <Reveal key={index} threshold={0.5}>
                            <div className={`flex flex-col md:flex-row items-center justify-center gap-8 md:gap-12 ${index % 2 !== 0 ? 'md:flex-row-reverse' : ''}`}>
                                {/* Circle with Header */}
                                <div className={`flex-shrink-0 w-48 h-48 rounded-full flex items-center justify-center text-center p-4 shadow-xl ${joyfulColors[index % joyfulColors.length]}`}>
                                    <h3 className="text-3xl font-serif-display text-stone-700 break-words">{item.header}</h3>
                                </div>
                                {/* Description */}
                                <div className="flex-grow max-w-md">
                                    <p className="text-lg text-stone-600 text-center md:text-left">{item.caption}</p>
                                </div>
                            </div>
                        </Reveal>
                    ))}
                </div>
            </div>
        );
    };

    const FutureSection = ({ plans }) => (
        <SectionWithGraphic graphic={<Compass />} graphicSide="left">
            <h2 className="text-center text-3xl font-serif-display text-stone-700 mb-12">Looking Ahead</h2>
            <div className="space-y-4 max-w-md mx-auto">
                {plans.map((plan, index) => (
                    <div key={index} className="text-center p-4 bg-white/50 border border-stone-200 rounded-lg">
                        <p className="text-lg text-stone-700">{plan}</p>
                    </div>
                ))}
            </div>
        </SectionWithGraphic>
    );

    const DreamGetawaySection = () => {
        const [plan, setPlan] = useState(null);
        const [loading, setLoading] = useState(false);

        const prewrittenPlan = {
            "title": "A Cozy Heritage Escape",
            "day1_morning": "Arrive at a beautiful heritage haveli. Settle in and enjoy a traditional breakfast.",
            "day1_afternoon": "Explore the intricate carvings of the local stepwell and feel the history around you.",
            "day1_evening": "A romantic, candlelit dinner on a rooftop overlooking the city.",
            "day2_morning": "A peaceful morning walk along the riverfront.",
            "day2_afternoon": "Get lost in the vibrant textiles and crafts at the local markets.",
            "day2_evening": "Enjoy the night food market, trying all the delicious street food.",
            "day3_morning": "A relaxed morning with a cup of chai and a final stroll through the old lanes.",
            "day3_afternoon": "Visit a local museum for a dose of art and culture.",
            "day3_evening": "Head home, filled with beautiful memories."
        };

        const showPlan = () => {
            setLoading(true);
            setTimeout(() => {
                setPlan(prewrittenPlan);
                setLoading(false);
            }, 1000);
        };

        return (
            <SectionWithGraphic graphic={<PaperPlane />} graphicSide="right">
                <h2 className="text-center text-3xl font-serif-display text-stone-700 mb-4">Dream Getaway Planner</h2>
                <p className="text-center text-stone-500 mb-8">Let's dream up our next adventure together.</p>
                <div className="flex flex-col items-center space-y-4">
                    <button
                        onClick={showPlan}
                        disabled={loading || plan}
                        className="px-6 py-3 bg-rose-400 text-white font-bold rounded-lg shadow-md hover:bg-rose-500 transition-colors disabled:bg-stone-300"
                    >
                        {loading ? "Dreaming..." : (plan ? "Plan Revealed!" : "Reveal a Dream Trip ✨")}
                    </button>
                </div>

                {plan && (
                    <Reveal className="mt-12 text-left max-w-md mx-auto">
                        <h3 className="text-2xl font-serif-display text-center text-stone-800 mb-6">{plan.title}</h3>
                        <div className="space-y-6">
                            {['1','2','3'].map(day => (
                                <div key={day}>
                                    <h4 className="font-bold text-lg text-stone-700 border-b border-stone-200 pb-2 mb-2">Day {day}</h4>
                                    <p><strong className="text-stone-600">Morning:</strong> {plan[`day${day}_morning`]}</p>
                                    <p><strong className="text-stone-600">Afternoon:</strong> {plan[`day${day}_afternoon`]}</p>
                                    <p><strong className="text-stone-600">Evening:</strong> {plan[`day${day}_evening`]}</p>
                                </div>
                            ))}
                        </div>
                    </Reveal>
                )}
            </SectionWithGraphic>
        );
    };

    const TimeCapsuleSection = ({ capsule }) => {
        const [isUnlocked, setIsUnlocked] = useState(false);
        const unlockDate = new Date(capsule.unlockDate);
        const now = new Date();

        useEffect(() => { if (now >= unlockDate) { setIsUnlocked(true); } }, [unlockDate]);

        return (
            <div className="py-24 md:py-32 px-4 text-center">
                <Reveal>
                    <h2 className="text-3xl font-serif-display text-stone-700 mb-4">A Digital Time Capsule</h2>
                    <div className="p-8 border-2 border-dashed border-stone-300 rounded-lg max-w-2xl mx-auto">
                        {isUnlocked ? (
                            <p className="text-lg text-stone-600">{capsule.message}</p>
                        ) : (
                            <div>
                                <p className="text-lg text-stone-600">To be unlocked on:</p>
                                <p className="text-2xl font-bold text-stone-800 mt-2">{unlockDate.toLocaleDateString(undefined, { year: 'numeric', month: 'long', day: 'numeric' })}</p>
                            </div>
                        )}
                    </div>
                </Reveal>
            </div>
        );
    };

    const OutroSection = ({ yourName, secret }) => {
        const [isRevealed, setIsRevealed] = useState(false);
        return (
            <div className="h-[80vh] flex flex-col items-center justify-center text-center p-4 relative">
                <Reveal>
                    <p className="text-xl text-stone-500">Anyway, that's all.</p>
                    <h2 className="mt-4 text-3xl md:text-4xl font-serif-display text-stone-700">Hope this made you smile.</h2>
                    <p className="mt-6 text-xl text-stone-600">- {yourName}</p>
                </Reveal>
                <div className="absolute bottom-10 right-10">
                    <button onClick={() => setIsRevealed(!isRevealed)} className="w-6 h-6 text-stone-300 hover:text-rose-400 transition-colors" title="A little secret...">
                        <svg viewBox="0 0 100 100"><path d="M50,0 L61.2,35.3 H98.8 L68.8,57.2 L79.9,92.7 L50,70.7 L20.1,92.7 L31.2,57.2 L1.2,35.3 H38.8 Z" fill="currentColor"/></svg>
                    </button>
                </div>
                {isRevealed && <div className="absolute bottom-20 right-10 p-4 bg-white rounded-lg shadow-xl text-stone-700">{secret}</div>}
            </div>
        );
    };

    // --- SVG GRAPHICS (Unchanged) ---
    const Chocolate = () => <svg viewBox="0 0 100 100" className="transition-transform duration-500 ease-out"><g transform="rotate(15)"><path d="M10 30 L50 10 L90 30 L50 50 Z" fill="#5c2d2d"/><path d="M10 30 L10 70 L50 90 L50 50 Z" fill="#a35252"/><path d="M50 50 L50 90 L90 70 L90 30 Z" fill="#7c3a3a"/></g></svg>;
    const CoffeeCup = () => <svg viewBox="0 0 100 100" className="transition-transform duration-500 ease-out"><g transform="rotate(-10)"><path d="M10 90 L90 90 L85 20 L15 20 Z" fill="#fff" stroke="#d1d5db" strokeWidth="2"/><path d="M75 30 C95 40, 95 60, 75 70" stroke="#d1d5db" strokeWidth="2" fill="none"/><path d="M30 15 Q 40 10, 50 15" stroke="#a35252" strokeWidth="3" strokeLinecap="round"/><path d="M50 10 Q 60 5, 70 10" stroke="#a35252" strokeWidth="3" strokeLinecap="round"/></g></svg>;
    const Headphones = () => <svg viewBox="0 0 100 100" className="transition-transform duration-500 ease-out"><g transform="translate(50,50) scale(1.2) rotate(10)"><path d="M20-30 A30 30 0 0 1 -20 -30" stroke="#a8a29e" strokeWidth="4" fill="none"/><path d="M-20-30 L -20 0 A10 10 0 0 0 -30 10 L -30 20 A10 10 0 0 0 -20 30 L -20 10" fill="#e7e5e4" stroke="#a8a29e" strokeWidth="2"/><path d="M20-30 L 20 0 A10 10 0 0 1 30 10 L 30 20 A10 10 0 0 1 20 30 L 20 10" fill="#e7e5e4" stroke="#a8a29e" strokeWidth="2"/></g></svg>;
    const Compass = () => <svg viewBox="0 0 100 100" className="transition-transform duration-500 ease-out compass-svg"><g transform="translate(50,50)"><circle cx="0" cy="0" r="45" fill="white" stroke="#d1d5db" strokeWidth="2"/><path d="M0-35 L10 0 L0 35 L-10 0Z" fill="#a35252"/><path d="M0-35 L-10 0 L0 35 L10 0Z" fill="#e7e5e4"/><circle cx="0" cy="0" r="5" fill="#a35252"/></g></svg>;
    const PaperPlane = () => <svg viewBox="0 0 100 100" className="transition-transform duration-500 ease-out"><g transform="translate(50,50) rotate(-20) scale(1.2)"><path d="M0 -40 L 40 30 L 0 10 L -40 30 Z" fill="#a8a29e"/><path d="M0 -40 L 0 10 L 10 15" fill="#e7e5e4"/></g></svg>;

    ReactDOM.render(<App />, document.getElementById('root'));
</script>
</body>
</html>
